<Page
  x:Class="aathoos.Views.TasksPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:core="using:aathoos.Core"
  Background="{StaticResource AppBackgroundBrush}">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="1" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <Grid Grid.Row="0" Padding="32,32,32,20">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <StackPanel Grid.Column="0" Spacing="4">
        <TextBlock Text="Tasks"
          Style="{StaticResource TitleLargeTextBlockStyle}" FontWeight="Bold"
          Foreground="{StaticResource AppForegroundBrush}" />
        <TextBlock Text="Deadlines, priorities, progress"
          Style="{StaticResource BodyTextBlockStyle}"
          Foreground="{StaticResource AppMutedBrush}" />
      </StackPanel>

      <Button x:Name="AddButton" Grid.Column="1"
        Click="OnAddClick"
        Background="{StaticResource AppSurfaceBrush}"
        VerticalAlignment="Center"
        CornerRadius="8" Padding="12,8">
        <FontIcon Glyph="&#xE710;" FontSize="14"
          Foreground="{StaticResource AppForegroundBrush}" />
      </Button>
    </Grid>

    <Border Grid.Row="1" Background="{StaticResource AppBorderBrush}" />

    <!-- Content -->
    <Grid Grid.Row="2">

      <!-- Empty state -->
      <StackPanel x:Name="EmptyState"
        HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12"
        Visibility="Collapsed">
        <FontIcon Glyph="&#xE73E;" FontSize="40"
          Foreground="{StaticResource AppForegroundBrush}" Opacity="0.2" />
        <TextBlock Text="No tasks yet"
          Style="{StaticResource SubtitleTextBlockStyle}"
          Foreground="{StaticResource AppForegroundBrush}" Opacity="0.35"
          HorizontalAlignment="Center" />
        <TextBlock Text="Press + to add your first task"
          Style="{StaticResource CaptionTextBlockStyle}"
          Foreground="{StaticResource AppMutedBrush}"
          HorizontalAlignment="Center" />
      </StackPanel>

      <!-- Task list -->
      <ListView x:Name="TaskList"
        SelectionMode="None"
        ItemContainerStyle="{StaticResource PlainListViewItemStyle}">
        <ListView.ItemTemplate>
          <DataTemplate x:DataType="core:ATask">
            <Grid ColumnSpacing="12" Padding="16,10" Margin="16,3"
              Background="{StaticResource AppSurfaceBrush}" CornerRadius="8">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>

              <!-- Toggle complete -->
              <Button Grid.Column="0"
                Tag="{x:Bind Id}"
                Click="OnToggleClick"
                Background="Transparent" BorderThickness="0"
                Padding="0" Width="28" Height="28"
                VerticalAlignment="Center">
                <FontIcon
                  Glyph="{x:Bind IsCompleted, Converter={StaticResource BoolToCheckGlyphConverter}}"
                  FontSize="18"
                  Foreground="{StaticResource AppAccentBrush}"
                  Opacity="{x:Bind IsCompleted, Converter={StaticResource BoolToOpacityConverter}}" />
              </Button>

              <!-- Title + notes -->
              <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                <TextBlock
                  Text="{x:Bind Title}"
                  Style="{StaticResource BodyTextBlockStyle}"
                  Foreground="{StaticResource AppForegroundBrush}"
                  Opacity="{x:Bind IsCompleted, Converter={StaticResource BoolToOpacityConverter}}"
                  TextTrimming="CharacterEllipsis" />
                <TextBlock
                  Text="{x:Bind Notes}"
                  Style="{StaticResource CaptionTextBlockStyle}"
                  Foreground="{StaticResource AppMutedBrush}"
                  TextTrimming="CharacterEllipsis"
                  Visibility="{x:Bind Notes, Converter={StaticResource NullOrEmptyToVisibilityConverter}}" />
              </StackPanel>

              <!-- Priority badge -->
              <Border Grid.Column="2" CornerRadius="4" Padding="7,3"
                Background="{StaticResource AppBorderBrush}"
                VerticalAlignment="Center">
                <TextBlock
                  Text="{x:Bind Priority, Converter={StaticResource PriorityToLabelConverter}}"
                  Style="{StaticResource CaptionTextBlockStyle}" FontWeight="SemiBold"
                  Foreground="{StaticResource AppAccentBrush}" />
              </Border>

              <!-- Delete -->
              <Button Grid.Column="3"
                Tag="{x:Bind Id}"
                Click="OnDeleteClick"
                Background="Transparent" BorderThickness="0"
                Padding="0" Width="28" Height="28"
                VerticalAlignment="Center" Opacity="0.4">
                <FontIcon Glyph="&#xE74D;" FontSize="13"
                  Foreground="{StaticResource AppForegroundBrush}" />
              </Button>
            </Grid>
          </DataTemplate>
        </ListView.ItemTemplate>
      </ListView>
    </Grid>
  </Grid>
</Page>
